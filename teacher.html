<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">

    <title>PROFESSOR</title>
    
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/lightbox.css">

    <!-- WEB3 CDN -->
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@0.18.2/dist/web3.min.js"></script>

  </head>

<body>

 
  <!--header-->
  <header class="main-header clearfix" role="header">
    <div class="logo">
      <a href="home.html"><em>My</em> University</a>
    </div>
    <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
    <nav id="menu" class="main-nav" role="navigation">
      <ul class="main-menu">
        <li><a href="#top">Home</a></li>
        <li><a href="#top2">My students</a></li>
        <li><a href="#" id="myprofile" data-toggle="modal" data-target="#exampleModalLong1">My Profile</a></li>
        <li><a href="teacher.html" id="login">Login</a></li>
        <li><a href="home.html" id="logout">Logout</a></li>
      </ul>
    </nav>
  </header>

  
  <!-- ***** Main Banner Area Start ***** -->
  <section class="section main-banner" id="top" data-section="section1">
    <video autoplay muted loop id="bg-video">
        <!--<source src="assets/images/course-video.mp4" type="video/mp4" />-->
    </video>

    <div class="video-overlay header-text">
        <div class="caption">
          
            <h2><em>Hello</em></h2>
            <h2 id="name"></h2>
            <div class="main-button">
                <p>
                  <a class="btn btn-primary tog" id="stdCount" data-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">No of Students</a>
                </p>
                
<!-- Multiple Targets START-->



<div class="row">
  <div class="col">
    <div class="collapse multi-collapse" id="multiCollapseExample1">
      <div class="card card-body">
        <p id="stdCountValue"  style="font-size: large;"></p>
      </div>
    </div>
  </div>
  </div>
</div>

<!-- Multiple Targets END-->
            
        </div>
    </div>
</section>
<!-- ***** Main Banner Area End ***** -->


<section class="section why-us" data-section="section2" id="top2">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="section-heading">
            <h2>Students</h2>
          </div>
        </div>
        <div class="col-md-12">
          
            <section class='tabs-content'>
              
                <div id="accordion">
                    <div class="card">
                      <div class="card-header" id="headingOne" style="background-color: #eb505d;">
                        <h5 class="mb-0 text-center">
                          <button class="btn btn-link" style="color: white;font-size: 15px;font-weight: 700;letter-spacing: 0.5px;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                           ALL STUDENTS
                          </button>
                        </h5>
                      </div>
                  
                      <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="input-group mb-3" style="width: 400px;align-items: center;margin: auto;">
                          <input type="number" id="searchtext" style="background-color: rgba(51, 44, 45, 0.99);color: wheat;"
                            class="form-control" placeholder="Search by ID" aria-label="Recipient's username"
                            aria-describedby="basic-addon2">
                          <div class="input-group-append">
                            <button class="btn btn-danger" id="find" type="button">Search</button>
                          </div>
                        </div>

                        <div class="card-body" style="background-color: wheat;">
                            <div class="clsscroll">

                            
                            <table class="table table-hover table-dark">
                                <thead class="thead-light">
                                  <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">ID</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Inc</th>
                                    <th scope="col"></th>
                                  </tr>
                                </thead>
                                <tbody id="tbody">
                                  
                                  
                                </tbody>
                              </table>
                            </div>
                        </div>
                      </div>
                    </div>

                  </div>
              
            </section>
          </div>
        </div>
      </div>
    </div>
  </section>



  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <p><i class="fa fa-copyright"></i> &nbsp;Reahaan Sheriff</p>
        </div>
      </div>
    </div>
  </footer>


  

<!-- Modal for my profile-->
<div class="modal fade" id="exampleModalLong1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Details</th>
              </tr>
            </thead>
            <tbody id="myprofilebody">
              
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <!--<button type="button" class="btn btn-primary">Save changes</button>-->
        </div>
      </div>
    </div>
  </div>



   
<!-- Modal for viewing details of particular student-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table table-hover">
            <thead class="thead-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Details</th>
              </tr>
            </thead>
            <tbody id="newdetails">
              
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <!--<button type="button" class="btn btn-primary">Save changes</button>-->
        </div>
      </div>
    </div>
  </div>
  


<!-- Modal for Tracking Attendance-->
<div class="modal fade" id="track" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Attendence History</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Date and Time</th>
            </tr>
          </thead>
          <tbody id="attend"></tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="assets/js/abi.js"></script>
<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script> -->
<script src="assets/js/web3.js"></script>

<!-- Scripts -->
<!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- Bootstrap core JavaScript -->
<!-- <script src="vendor/jquery/jquery.min.js"></script> -->
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- <script src="assets/js/isotope.min.js"></script> -->
<script src="assets/js/owl-carousel.js"></script>
<script src="assets/js/lightbox.js"></script>
<script src="assets/js/tabs.js"></script>
<script src="assets/js/video.js"></script>
<script src="assets/js/slick-slider.js"></script>
<script src="assets/js/custom.js"></script>
<script>



var id=window.location.search;
var myid = parseInt(id.slice(9,));
console.log(myid);

if(id==""){
  $("#logout").hide();
  $("#login").show();
} else{
  $("#logout").show();
  $("#login").hide();
}

window.history.forward();
    function noBack() {
      window.history.forward();
    }
        

//MY profile
$("#myprofile").click(function(){
  AttendanceManagement.getParticularTeacher(myid,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {
                  var my = result[0];
                  $("#myprofilebody").html("<tr><th scope='row'>1</th><td>Id</td><td>"+myid+"</td></tr><tr><th scope='row'>2</th><td>Name</td><td>"+result[1]+"</td></tr><tr><th scope='row'>3</th><td>Course</td><td>"+result[2]+"</td></tr><tr><th scope='row'>4</th><td>Department</td><td>"+result[3]+"</td></tr>");
                
                  $("#name").html(result[1]);

                  console.log(result);
                }
                else
                  console.error(error);
              });
  
});
AttendanceManagement.getParticularTeacher(myid,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {
                  $("#name").html(result[1]);

                  console.log(result);
                }
                else
                  console.error(error);
              });



    // Counting No of students
var count = 0;
    AttendanceManagement.getStudents({from:acctFromAddress,gas:3000000},function (error, result) {
      if (!error) {
        
        $.each(result, function (index, value) {
          AttendanceManagement.getParticularStudent(value,{from:acctFromAddress,gas:3000000}, function (error, result) {
            if (!error) {
    var stucourse = AttendanceManagement.seeCourse(result[0],{from:acctFromAddress,gas:3000000});
    var teacourse = AttendanceManagement.getParticularTeacher(myid,{from:acctFromAddress,gas:3000000})[2];
    if(stucourse == teacourse){
      count = count + 1;
      $("#stdCountValue").html(count);
    }
            }
          });
        });
       
      }
    });
  
    // $("#stdCount").click(function () {
    //   AttendanceManagement.countStudents(function (error, result) {
    //     if (!error) {
          
    //       $("#stdCountValue").html(result["c"][0]);

    //       console.log(result["c"][0]);
    //     }
    //     else
    //       console.error(error);
    //   });
    // });


      //For getting all Students Details
    // <td><button class='btn btn-danger' onclick='viewstudent("+result[0]+")' type='button' data-toggle='modal' data-target='#exampleModalLong2'>view</button></td>

    AttendanceManagement.getStudents({from:acctFromAddress,gas:3000000},function (error, result) {
      if (!error) {
        
        $.each(result, function (index, value) {
          AttendanceManagement.getParticularStudent(value,{from:acctFromAddress,gas:3000000}, function (error, result) {
            if (!error) {
              var course = AttendanceManagement.seeCourse(result[0],{from:acctFromAddress,gas:3000000});
              var tcourse = AttendanceManagement.getParticularTeacher(myid,{from:acctFromAddress,gas:3000000})[2];
               
              if(course == tcourse){
                $("#tbody").append("<tr><th scope='row'>"+index+"</th><td>"+result[0]+"</td><td>"+result[1]+"</td><td><button id='inc' onclick='inc("+result[0]+")' class='btn btn-success'>+</button></td><td><a href='#' class='btn btn-danger'  onclick='viewstudent("+result[0]+")' data-toggle='modal' data-target='#exampleModalLong2'>view</a></td></tr>");

              }


              console.log(result);
            }
            else
              console.error(error);
          });
        });
        console.log(result[0]);
      }
      else
        console.error(error);
    });

// view student
    function viewstudent(id){
      AttendanceManagement.getParticularStudent(id,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {

                  $("#newdetails").html("<tr><th scope='row'>1</th><td>Id</td><td>"+result[0]+"</td></tr><tr><th scope='row'>2</th><td>Name</td><td>"+result[1]+"</td></tr><th scope='row'>3</th><td>Attendance</td><td id='ainc'>"+result[2]+"&nbsp;&nbsp;<button class='btn btn-primary' onclick='track("+result[0]+")' data-toggle='modal' data-target='#exampleModalLong2'>Track</button></td></tr><tr><th scope='row'>4</th><td>Department</td><td>"+result[3]+"</td></tr><tr><th scope='row'>5</th><td>Degree</td><td>"+result[4]+"</td></tr><tr><th scope='row'>6</th><td>Year</td><td>"+result[5]+"</td></tr><tr><th scope='row'>7</th><td>Date of birth</td><td>"+result[6]+"</td></tr>");
                  // $("#stdDetails").html('Name: ' + result[0] + '<br />' + 'Attendace: ' + result[1] + '<br />' + 'Department : ' + result[2] + '<br />' + 'Degree: ' + result[3] + '<br />' + 'Year: ' + result[4]);
                  
                  // $("#no").append("<tr><th scope='row'>"+(index+1)+"</tr></th>"+'<br />');
                  //   $("#tid").append("<tr><td>"+result[0]+"</tr></td>"+'<br />');
                  //   $("#tname").append("<tr><td>"+result[1]+"</tr></td>"+'<br />');
                  // + '<br />' + 'Attendace: ' + result[1] + '<br />' + 'Department : ' + result[2] + '<br />' + 'Degree: ' + result[3] + '<br />' + 'Year: ' + result[4] + '<br />');
                  console.log(result);
                }
      });
                AttendanceManagement.seeCourse(id,{from:acctFromAddress,gas:3000000}, function (error, result) {
                $("#newdetails").append("<tr><th scope='row'>8</th><td>Course</td><td>"+result+"</td></tr>");
                if (!error) {
                  $('#myModal').modal('show');
                  console.log(result);
                }
                else
                  console.error(error);

              });
  }

// Tracking
function track(id){
AttendanceManagement.incrementAttendance(id,{from:acctFromAddress,gas:3000000},function (error, result){
  var all_track = []
              var all_dates = []
              if(!error){
                $.each(result, function(index, value){
                  all_track.push(value);
                  var t = parseInt(value)*1000;
                  var date = new Date(t);
                  if(all_dates.includes(date)==false){
                    all_dates.push(date);
                  }
                });
                if($("#attend").text() == ""){
                  for(var i=0;i<all_dates.length;i++){
                  
                    $("#attend").append("<tr><td>"+(i+1)+"</td><td>"+all_dates[i]+"</td></tr>");
                }
              }
                all_dates = [];
                all_track = [];
                if (!error) {
                  $('#track').modal('show');
                  console.log(result);
                }
                else{
                  console.error(error);
                }
                console.log('after '+all_track);
                console.log('after '+all_dates);
                console.log(result[0]);
              }else{
                console.error(error);
              }
            });
          }
  // Increment attendance
  
  function inc(id){
            AttendanceManagement.addAttendance(id,{from:acctFromAddress,gas:3000000});
            AttendanceManagement.getParticularStudent(id,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {
                    $("#ainc").html(result[2]);
                    console.log(result);
                }
                else
                    console.error(error);
            });
        
      }

//      // Decrement attendance
//   function dec(id){

// AttendanceManagement.decrementAttendance(id,{from:acctFromAddress,gas:3000000});
// AttendanceManagement.getParticularStudent(id, function (error, result) {
//     if (!error) {
//         $("#ainc").html(result[2]);

//         console.log(result);
//     }
//     else
//         console.error(error);
// });

// }

// Search student
var tempo = [];
    var sid = [];
    // Search for students
    $('#find').click(function () {
      if ($("#searchtext").val() != "") {
        AttendanceManagement.getStudents({from:acctFromAddress,gas:3000000},function (error, result) {

          if (!error) {
            $.each(result, function (index, value) {

              tempo.push(value);
              for (var i = 0; i < tempo.length; i++) {
                sid.push(tempo[i]["c"][0]);
              }
            });
            if (sid.includes(parseInt($("#searchtext").val())) === true) {

              AttendanceManagement.getParticularStudent($("#searchtext").val(),{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {

                  $("#newdetails").html("<tr><th scope='row'>1</th><td>Id</td><td>"+result[0]+"</td></tr><tr><th scope='row'>2</th><td>Name</td><td>"+result[1]+"</td></tr><th scope='row'>3</th><td>Attendance</td><td>"+result[2]+"</td></tr><tr><th scope='row'>4</th><td>Department</td><td>"+result[3]+"</td></tr><tr><th scope='row'>5</th><td>Degree</td><td>"+result[4]+"</td></tr><tr><th scope='row'>6</th><td>Year</td><td>"+result[5]+"</td></tr><tr><th scope='row'>7</th><td>Date of birth</td><td>"+result[6]+"</td></tr>");
                


                  console.log(result);
                }
                else
                  console.error(error);
              });
              AttendanceManagement.seeCourse($("#searchtext").val(),{from:acctFromAddress,gas:3000000}, function (error, result) {
                $("#newdetails").append("<tr><th scope='row'>8</th><td>Course</td><td>"+result+"</td></tr>");
                if (!error) {
                  console.log(result);
                  $('#myModal').modal('show');
                }
                else
                  console.error(error);

              });
            } else {
              alert('ID does not exists');
            }
          }
        });
      } else {
        alert("Empty text box");
        $('#myModal').modal('hide');
      }
    });



// Toggling for no of students... textbox
$('.tog').on('mouseenter',function(){
	        $(this).css("background-color","#F83243;");
        });




        // //according to loftblog tut
        // $('.nav li:first').addClass('active');

        // var showSection = function showSection(section, isAnimate) {
        //   var
        //   direction = section.replace(/#/, ''),
        //   reqSection = $('.section').filter('[data-section="' + direction + '"]'),
        //   reqSectionPos = reqSection.offset().top - 0;

        //   if (isAnimate) {
        //     $('body, html').animate({
        //       scrollTop: reqSectionPos },
        //     800);
        //   } else {
        //     $('body, html').scrollTop(reqSectionPos);
        //   }

        // };

        var checkSection = function checkSection() {
          $('.section').each(function () {
            var
            $this = $(this),
            topEdge = $this.offset().top - 80,
            bottomEdge = topEdge + $this.height(),
            wScroll = $(window).scrollTop();
            if (topEdge < wScroll && bottomEdge > wScroll) {
              var
              currentId = $this.data('section'),
              reqLink = $('a').filter('[href*=\\#' + currentId + ']');
              reqLink.closest('li').addClass('active').
              siblings().removeClass('active');
            }
          });
        };

        // $('.main-menu, .scroll-to-section').on('click', 'a', function (e) {
        //   if($(e.target).hasClass('external')) {
        //     return;
        //   }
        //   e.preventDefault();
        //   $('#menu').removeClass('active');
        //   showSection($(this).attr('href'), true);
        // });

        $(window).scroll(function () {
          checkSection();
        });
    </script>
</body>
</html>