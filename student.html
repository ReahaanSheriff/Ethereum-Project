<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">

  <title>STUDENT</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="assets/css/fontawesome.css">
  <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
  <link rel="stylesheet" href="assets/css/owl.css">
  <link rel="stylesheet" href="assets/css/lightbox.css">

<!-- WEB3 CDN -->
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@0.18.2/dist/web3.min.js"></script>

</head>

<body>


  <!--header-->
  <header class="main-header clearfix" role="header">
    <div class="logo">
      <a href="home.html"><em>My</em> University</a>
    </div>
    <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
    <nav id="menu" class="main-nav" role="navigation">
      <ul class="main-menu">
        <li><a href="#top">Home</a></li>
        <li><a href="#bg">My Courses</a></li>
        <li><a href="#" data-toggle="modal" id="profile" data-target="#exampleModalLong2">My Profile</a></li>
        <li><a href="home.html" id="logout">Logout</a></li>
        <li><a href="student.html" id="login">Login</a></li>
      </ul>
    </nav>
  </header>


  <!-- ***** Main Banner Area Start ***** -->
  <section class="section main-banner" id="top" data-section="section1">
    <video autoplay muted loop id="bg-video">
        <!--<source src="assets/images/course-video.mp4" type="video/mp4" />-->
    </video>

    <div class="video-overlay header-text">
        <div class="caption">
            
            <h2><em>Hello</em></h2>
            <h2 id="name"></h2>
            
            
            <div class="main-button">
              <div class="scroll-to-section"><a href="#top2">Register your course</a></div>
            </div>
        </div>
    </div>
</section>
<!-- ***** Main Banner Area End ***** -->



  <section class="section courses" data-section="section1" style="background-color:rgba(22,34,57,0.85);">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="section-heading">
            <h2 style="background-color: #F83243;border:1px solid white;">Courses Offered</h2>
          </div>
        </div>
        <div id="cou" class="row">
        </div>
        
      </div>
    </div>
  </section>


  <section class="section contact" data-section="section2" id="top2">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="section-heading">
            <h2>Pick your course</h2>
          </div>
        </div>
        <div id="contact">
          <div class="row">
            <div class="col-md-6">
              <fieldset>
                <input name="Number" type="text" class="form-control" id="myid" placeholder="Your ID">
              </fieldset>
            </div>
            
            <div class="col-md-12">
              <fieldset>
                <input name="message" rows="6" class="form-control" id="mycourse" placeholder="Your course name..."
                  required="">
              </fieldset>
            </div>
            <div class="col-md-12">
              <fieldset>
                <button type="submit" id="form-submit" class="button">Register</button>
              </fieldset>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section courses" data-section="section3" id="bg">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="section-heading">
            <h2>My Course</h2>
          </div>
        </div>
        
        <div class="card" style="width: 18rem;">
          <img class="card-img-top" src="assets/images/download.jpg" alt="Card image cap">
          <div class="card-body">
            <h4 id="mycoursename"></h4>
            <p class="card-text">We empower teachers with customizable and pre-built lesson plans, plus digital progress reports, so they can focus on the core curriculum</p>
              <!-- Button trigger modal -->
              <center><strong><button type="button" id="specific" class="btn btn-danger" style="color:white;align-items: center;" data-toggle="modal" data-target="#exampleModalLong">
                View
              </button></strong></center>
        </div>
      </div>
      </div>
    </div>
  </section>



<!-- Modal for view course-->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Title</th>
              <th scope="col">Details</th>
            </tr>
          </thead>
          <tbody id="viewcourse">
            
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
      </div>
    </div>
  </div>
</div>



<!-- Modal for my profile-->
<div class="modal fade" id="exampleModalLong2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Title</th>
              <th scope="col">Details</th>
            </tr>
          </thead>
          <tbody id="profilebody">
            
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
      </div>
    </div>
  </div>
</div>




<!-- Modal for Tracking Attendance-->
<div class="modal fade" id="exampleModalLong3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Attendence History</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Date and Time</th>
            </tr>
          </thead>
          <tbody id="attend"></tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
      </div>
    </div>
  </div>
</div>

  <!-- Scripts -->
  <script src="assets/js/abi.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="assets/js/web3.js"></script>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script src="assets/js/isotope.min.js"></script>
  <script src="assets/js/owl-carousel.js"></script>
  <script src="assets/js/lightbox.js"></script>
  <script src="assets/js/tabs.js"></script>
  <script src="assets/js/video.js"></script>
  <script src="assets/js/slick-slider.js"></script>
  <script src="assets/js/custom.js"></script>
  <script>
var id=window.location.search;
var myid = parseInt(id.slice(9,));
console.log(myid);

if(id==""){
  $("#logout").hide();
  $("#login").show();
} else{
  $("#logout").show();
  $("#login").hide();
}

  window.history.forward();
    function noBack() {
      window.history.forward();
    }
                  
//MY profile
$("#profile").click(function(){
  AttendanceManagement.getParticularStudent(myid,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {
                  var my = result[0];
                  $("#profilebody").html("<tr><th scope='row'>1</th><td>id</td><td>"+result[0]+"</td></tr><tr><th scope='row'>2</th><td>name</td><td>"+result[1]+"</td></tr><tr><th scope='row'>3</th><td>Date Of Birth</td><td>"+result[6]+"</td></tr><tr><th scope='row'>4</th><td>Department</td><td>"+result[3]+"</td></tr><tr><th scope='row'>5</th><td>Degree</td><td>"+result[4]+"</td></tr><tr><th scope='row'>6</th><td>Year</td><td>"+result[5]+"</td></tr>");
                
                  $("#name").html(result[1]);

                  console.log(result);
                }
                else
                  console.error(error);
              });
  
});
AttendanceManagement.getParticularStudent(myid,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {
                  $("#name").html(result[1]);

                  console.log(result);
                }
                else
                  console.error(error);
              });


// Course
var c = AttendanceManagement.seeCourse(myid,{from:acctFromAddress, gas: 3000000 });
$("#mycoursename").html(c);
// Enrolling course

$("#form-submit").click(function(){
  if(($("#myid").val() != "") && ($("#mycourse").val() != "")){
    if($("#myid").val() == myid){
    if(c == ""){
      AttendanceManagement.enrollCourse(parseInt($("#myid").val()),$("#mycourse").val().toLowerCase(),{from:acctFromAddress, gas: 3000000 });
    }else{
        alert("Already enrolled");
      }
    }else{
      alert("Incorrect data");
    }
  }else{
      alert("Empty fields not allowed");
    }
  
});

// Viewing course details
var i = AttendanceManagement.tecourse(c)[0];
var n = AttendanceManagement.tecourse(c)[1];
$("#specific").click(function(){
  AttendanceManagement.getParticularStudent(myid,{from:acctFromAddress,gas:3000000}, function (error, result) {
                if (!error) {
                  var att = result[2];
                  $("#viewcourse").html("<tr><th scope='row'>1</th><td>course name</td><td>"+c+"</td></tr><tr><th scope='row'>2</th><td>professor id</td><td>"+i+"</td></tr><tr><th scope='row'>3</th><td>professor name</td><td>"+n+"</td></tr><tr><th scope='row'>4</th><td>Attendance</td><td>"+att+"&nbsp;&nbsp;<button class='btn btn-primary' onclick='track("+myid+")' data-toggle='modal' data-target='#exampleModalLong3'>Track</button></td></tr>");
                  console.log(result);
                }
                else
                  console.error(error);
              });

  
});

if(c != ""){
  $("#bg").show();
}else{
  $("#bg").hide();
}


    //For getting all Courses Details
    //<td><a href='#' id='view' class='btn btn-danger kk'  data-toggle='modal' data-target='#exampleModalLong2'>view</a></td>

    AttendanceManagement.getTeachers({from:acctFromAddress,gas:3000000},function (error, result) {
      if (!error) {
        $.each(result, function (index, value) {
          AttendanceManagement.getParticularTeacher(value, function (error, result) {
            if (!error) {


              
              $("#cou").append("<div class='card m-3' style='width: 18rem;'><img class='card-img-top' src='assets/images/download.jpg' alt='Card image cap'><div class='card-body'><h4 id='cname'>"+result[2]+"</h4><p class='card-text'>We empower teachers with customizable and pre-built lesson plans, plus digital progress reports, so they can focus on the core curriculum</p><label for='tname' style='float: right; font-size: smaller;''><span>- </span>"+result[1]+"</label></div></div>");

             


              console.log(result);
            }
            else
              console.error(error);
          });
        });
        console.log(result[0]);
      }
      else
        console.error(error);
    });



// Tracking
function track(id){
AttendanceManagement.incrementAttendance(id,{from:acctFromAddress,gas:3000000},function (error, result){
  var all_track = []
              var all_dates = []
              if(!error){
                $.each(result, function(index, value){
                  all_track.push(value);
                  var t = parseInt(value)*1000;
                  var date = new Date(t);
                  if(all_dates.includes(date)==false){
                    all_dates.push(date);
                  }
                });
                if($("#attend").text() == ""){
                  for(var i=0;i<all_dates.length;i++){
                  
                    $("#attend").append("<tr><td>"+(i+1)+"</td><td>"+all_dates[i]+"</td></tr>");
                }
              }
                all_dates = [];
                all_track = [];
                // if (!error) {
                //   $('#track').modal('show');
                //   console.log(result);
                // }
                // else{
                //   console.error(error);
                // }
                console.log('after '+all_track);
                console.log('after '+all_dates);
                console.log(result[0]);
              }else{
                console.error(error);
              }
            });
          }

    // //according to loftblog tut
    // $('.nav li:first').addClass('active');

    // var showSection = function showSection(section, isAnimate) {
    //   var
    //     direction = section.replace(/#/, ''),
    //     reqSection = $('.section').filter('[data-section="' + direction + '"]'),
    //     reqSectionPos = reqSection.offset().top - 0;

    //   if (isAnimate) {
    //     $('body, html').animate({
    //       scrollTop: reqSectionPos
    //     },
    //       800);
    //   } else {
    //     $('body, html').scrollTop(reqSectionPos);
    //   }

    // };

    var checkSection = function checkSection() {
      $('.section').each(function () {
        var
          $this = $(this),
          topEdge = $this.offset().top - 80,
          bottomEdge = topEdge + $this.height(),
          wScroll = $(window).scrollTop();
        if (topEdge < wScroll && bottomEdge > wScroll) {
          var
            currentId = $this.data('section'),
            reqLink = $('a').filter('[href*=\\#' + currentId + ']');
          reqLink.closest('li').addClass('active').
            siblings().removeClass('active');
        }
      });
    };

    // $('.main-menu, .scroll-to-section').on('click', 'a', function (e) {
    //   if ($(e.target).hasClass('external')) {
    //     return;
    //   }
    //   e.preventDefault();
    //   $('#menu').removeClass('active');
    //   showSection($(this).attr('href'), true);
    // });

    $(window).scroll(function () {
      checkSection();
    });
  </script>

</body>

</html>